<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N2 文法單字特訓 (本地紀錄版)</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --success: #10b981;
            --error: #ef4444;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 650px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        h1 { text-align: center; margin: 0 0 10px 0; font-size: 1.5rem; color: var(--primary); }
        
        /* Menu Screen */
        #menu-screen { display: flex; flex-direction: column; gap: 15px; }
        .set-btn {
            padding: 15px;
            background: white;
            border: 2px solid #e5e7eb;
            color: var(--text);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .set-btn:hover:not(.disabled) { border-color: var(--primary); background: #eff6ff; }
        .set-btn.disabled { opacity: 0.6; cursor: not-allowed; background: #f9fafb; }
        
        .set-info { display: flex; flex-direction: column; gap: 4px; }
        .set-title { font-weight: bold; font-size: 1.1rem; }
        .set-status { font-size: 0.85rem; color: var(--text-light); display: flex; gap: 10px; }
        .badge { 
            background: #e5e7eb; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; 
        }
        .badge.high-score { background: #d1fae5; color: #065f46; }

        /* Quiz Screen */
        #quiz-screen { display: none; }
        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 10px;
            font-weight: 500;
        }
        .question-box {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 24px;
            line-height: 1.6;
            padding: 10px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .options-grid { display: flex; flex-direction: column; gap: 12px; }
        .option-btn {
            padding: 16px;
            text-align: left;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            position: relative;
        }
        .option-btn:hover:not(.disabled) { border-color: var(--primary); background: #eff6ff; }
        .option-btn.correct { background: #d1fae5; border-color: var(--success); color: #065f46; }
        .option-btn.wrong { background: #fee2e2; border-color: var(--error); color: #991b1b; }

        .explanation-box {
            margin-top: 25px;
            padding: 20px;
            background: #f8fafc;
            border-left: 5px solid var(--primary);
            border-radius: 6px;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .exp-title { font-weight: bold; color: var(--primary); margin-bottom: 8px; font-size: 1.05rem;}
        .exp-detail { font-size: 0.95rem; margin-bottom: 8px; color: #374151; line-height: 1.5; }
        .exp-example { font-style: italic; color: #6b7280; font-size: 0.9rem; background: #fff; padding: 8px; border-radius: 4px; border: 1px dashed #cbd5e1; }

        .nav-btn {
            margin-top: 20px;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            display: none;
            box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
        }
        .nav-btn:hover { background: var(--primary-dark); }

        /* Result Screen */
        #result-screen { display: none; text-align: center; padding: 20px 0; }
        .score-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px auto;
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4);
        }
        .home-btn {
            background: #374151;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 30px;
        }

        .footer-tools {
            margin-top: 30px;
            border-top: 1px solid #e5e7eb;
            padding-top: 15px;
            text-align: center;
        }
        .reset-link {
            color: #9ca3af;
            font-size: 0.8rem;
            text-decoration: underline;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>N2 日本語能力試驗對策</h1>

    <div id="menu-screen">
        <div id="set-buttons-container">
            </div>
        <div class="footer-tools">
            <span class="reset-link" onclick="clearAllData()">清除本機所有紀錄</span>
        </div>
    </div>

    <div id="quiz-screen">
        <div class="stats">
            <span id="question-count">Q: 1/50</span>
            <span id="score-display">Score: 0</span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        
        <div class="question-box" id="question-text">題目載入中...</div>
        
        <div class="options-grid" id="options-container">
            </div>

        <div class="explanation-box" id="explanation-area">
            <div class="exp-title">解説：<span id="exp-text"></span></div>
            <div class="exp-detail" id="exp-detail"></div>
            <div class="exp-example" id="exp-example"></div>
        </div>

        <button class="nav-btn" id="next-btn" onclick="nextQuestion()">下一題</button>
    </div>

    <div id="result-screen">
        <h2 style="color:var(--text)">測驗結束!</h2>
        <div class="score-circle" id="final-score"></div>
        <p id="result-message" style="font-size:1.1rem; color:var(--text-light)"></p>
        <div id="new-record-msg" style="color:var(--success); font-weight:bold; height: 24px;"></div>
        <button class="home-btn" onclick="goHome()">返回主選單</button>
    </div>
</div>

<script>
    // ==========================================
    // 資料區：內建第 1 回 與 第 2 回
    // ==========================================
    const allQuestionSets = {
        1: [
          { "id": 1, "q": "彼にお金を貸すなんて、捨てる＿＿＿だ。", "options": ["ようなもの", "ごときもの", "にせよ", "ばかり"], "answer": 0, "explanation": "「～ようなものだ」は「～と同じようだ」という意味を表す。", "detail": "這就像是...一樣（比喻）。借錢給他簡直就像是把錢丟掉一樣。", "example": "人生はマラソンのようなものだ。" },
          { "id": 2, "q": "この薬は副作用の＿＿＿があるので、医師の指示に従ってください。", "options": ["おそれ", "おかげ", "せい", "かぎり"], "answer": 0, "explanation": "「～おそれがある」は「悪いことが起こる可能性がある」という意味。", "detail": "～おそれがある：有...的危險/疑慮（通常用於負面情況）。", "example": "台風の上陸で、洪水のおそれがある。" },
          { "id": 3, "q": "努力した＿＿＿、試験に合格することができた。", "options": ["かいがあって", "かいもなく", "おかげで", "せいで"], "answer": 0, "explanation": "「～かいがあって」は「努力などの効果が表れて」という意味。", "detail": "～かいがあって：有～的價值/回報。沒有白費...。", "example": "練習のかいがあって、優勝できた。" },
          { "id": 4, "q": "彼は約束の時間に遅れた＿＿＿、謝りもしなかった。", "options": ["あげく", "ばかりか", "きり", "あまり"], "answer": 1, "explanation": "「～ばかりか」は「～だけでなく」という意味。", "detail": "～ばかりか：不但...而且...（不僅沒有道歉，還...）。", "example": "その店は味が悪いばかりか、店員の態度もひどい。" },
          { "id": 5, "q": "この曲を聞く＿＿＿、学生時代を思い出す。", "options": ["につけ", "たびに", "最中に", "とおりに"], "answer": 1, "explanation": "「～たびに」は「その時はいつも」という意味。", "detail": "～たびに：每當...的時候（總是會...）。", "example": "父は出張のたびに、お土産を買ってきてくれる。" },
          { "id": 6, "q": "忙しい＿＿＿、ご連絡をいただきありがとうございます。", "options": ["ところ", "こと", "もの", "わけ"], "answer": 0, "explanation": "「お忙しいところ」は相手に迷惑をかけることをわびる慣用表現。", "detail": "～ところ：在...的情況下/時候（常用於客套話）。百忙之中...", "example": "お休みのところ、お邪魔してすみません。" },
          { "id": 7, "q": "一度決めた＿＿＿、最後までやり遂げたい。", "options": ["からには", "といっても", "わりに", "くせに"], "answer": 0, "explanation": "「～からには」は「～なのだから当然」という決意や義務を表す。", "detail": "～からには：既然...就（表示決心或義務）。", "example": "試合に出るからには、勝ちたい。" },
          { "id": 8, "q": "会議の＿＿＿、携帯電話が鳴ってしまった。", "options": ["最中に", "うちに", "あいだに", "たびに"], "answer": 0, "explanation": "「～最中に」は「ちょうど～している時に」という意味。", "detail": "～最中に：正在...的時候（強調某個動作進行中被打斷）。", "example": "食事の最中に客が来た。" },
          { "id": 9, "q": "彼女は才能がある＿＿＿、努力も怠らない。", "options": ["うえに", "うちに", "かわりに", "とおりに"], "answer": 0, "explanation": "「～うえに」は「～に加えて」という意味。", "detail": "～うえに：再加上.../而且...（累加關係）。", "example": "昨日は寒いうえに、風も強かった。" },
          { "id": 10, "q": "この問題は複雑すぎて、私には理解し＿＿＿。", "options": ["かねる", "かける", "うる", "ざるを得ない"], "answer": 0, "explanation": "「～かねる」は「～しようとしてもできない」という婉曲的な不可能表現。", "detail": "～かねる：難以.../無法...（表示心理上或情境上的困難）。", "example": "その件については、お答えしかねます。" },
          { "id": 11, "q": "彼は周囲の反対を＿＿＿、留学を決めた。", "options": ["おして", "よそに", "ものともせず", "こめて"], "answer": 1, "explanation": "「～をよそに」は「～を気にしないで」という意味。", "detail": "～をよそに：不顧.../無視...（繼續做某事）。", "example": "親の心配をよそに、彼は遊び回っている。" },
          { "id": 12, "q": "新製品の発売に＿＿＿、イベントが行われた。", "options": ["先立って", "応じて", "加えて", "反して"], "answer": 0, "explanation": "「～に先立って」は「～の前に」という意味。", "detail": "～に先立って：在...之前/先行於...。", "example": "開会に先立って、挨拶があった。" },
          { "id": 13, "q": "このレストランは味もよければ、雰囲気も＿＿＿。", "options": ["よい", "いい", "よかった", "よくない"], "answer": 0, "explanation": "「Aも～ばBも～」で「AもBも両方」という意味。", "detail": "～も～ば～も...：既...又...（列舉並列）。", "example": "彼は勉強もできれば、スポーツもできる。" },
          { "id": 14, "q": "雨が降っている＿＿＿で、試合は中止になった。", "options": ["せい", "おかげ", "ため", "こと"], "answer": 0, "explanation": "「～せいで」は「～が原因で悪い結果になった」という意味。", "detail": "～せいで：都怪.../因為...的緣故（導致負面結果）。", "example": "寝坊したせいで、電車に乗り遅れた。" },
          { "id": 15, "q": "この仕事は、経験がない私には荷が＿＿＿。", "options": ["重い", "重すぎる", "勝つ", "負ける"], "answer": 0, "explanation": "「荷が重い」は「責任や負担が大きすぎて、能力を超えている」という意味。", "detail": "荷が重い：負擔太重/力不從心。", "example": "リーダーの役は、私には荷が重い。" },
          { "id": 16, "q": "彼は毎日、＿＿＿と勉強に励んでいる。", "options": ["せっせ", "いきいき", "うとうと", "まあまあ"], "answer": 0, "explanation": "「せっせと」は「休まずに熱心に」という意味。", "detail": "せっせと：拼命地/勤奮地。", "example": "彼は将来のために、せっせと貯金している。" },
          { "id": 17, "q": "商品の＿＿＿をご希望の方は、こちらにご記入ください。", "options": ["返品", "返却", "返信", "返済"], "answer": 0, "explanation": "「返品」は「買った商品を店に返すこと」という意味。", "detail": "返品：退貨。", "example": "サイズが合わなかったので、返品した。" },
          { "id": 18, "q": "このプロジェクトは、会社の将来に＿＿＿重要なものだ。", "options": ["関わる", "関する", "対する", "基づく"], "answer": 0, "explanation": "「～に関わる」は「～に重大な影響を及ぼす」という意味。", "detail": "～に関わる：關係到.../影響到...（通常指生死、名譽等重大事項）。", "example": "命に関わる病気ではない。" },
          { "id": 19, "q": "今回の失敗は、私の不注意による＿＿＿です。", "options": ["もの", "こと", "わけ", "ところ"], "answer": 0, "explanation": "「～によるものだ」は「～が原因だ」という意味。", "detail": "～によるものだ：是由於.../是...所造成的。", "example": "事故の原因は、スピードの出し過ぎによるものだ。" },
          { "id": 20, "q": "もっと早く家を出ればよかった。遅刻してしまって＿＿＿。", "options": ["悔しい", "情けない", "惜しい", "怪しい"], "answer": 0, "explanation": "「悔しい」は「残念で腹が立つ」という意味。", "detail": "悔しい：懊悔的/不甘心的。", "example": "試合に負けて悔しい。" },
          { "id": 21, "q": "彼は何も知らなかった＿＿＿をした。", "options": ["ふり", "まね", "こと", "わけ"], "answer": 0, "explanation": "「～ふりをする」は「実際は違うのに、そうであるように見せる」という意味。", "detail": "～ふりをする：裝作...的樣子。", "example": "聞こえないふりをした。" },
          { "id": 22, "q": "あの人は口が＿＿＿から、秘密は話さないほうがいい。", "options": ["軽い", "重い", "堅い", "悪い"], "answer": 0, "explanation": "「口が軽い」は「秘密などをすぐに人に話してしまう」という意味。", "detail": "口が軽い：嘴巴大/守不住秘密。", "example": "彼は口が軽いので、信用できない。" },
          { "id": 23, "q": "駅前でチラシを＿＿＿。", "options": ["配る", "配分する", "配達する", "配置する"], "answer": 0, "explanation": "「配る」は「多くの人に渡す」という意味。",
    "detail": "配る：分發/發送。", "example": "先生がテスト用紙を配る。" },
          { "id": 24, "q": "この計画を実行に移す＿＿＿、いくつかの問題点がある。", "options": ["にあたって", "につれて", "に際して", "に伴って"], "answer": 0, "explanation": "「～にあたって」は「～をする時に（その準備として）」という意味。", "detail": "～にあたって：在...之際/正當...時候（表示面臨某重要階段）。", "example": "開会にあたって、一言ご挨拶申し上げます。" },
          { "id": 25, "q": "彼は、自分の意見を主張して＿＿＿。", "options": ["やまない", "譲らない", "離さない", "通さない"], "answer": 1, "explanation": "「譲らない」は「自分の考えを変えない」という意味。", "detail": "譲らない：不退讓/堅持己見。", "example": "彼は一歩も譲らない。" },
          { "id": 26, "q": "最近、目が悪くなったせいか、字が＿＿＿見える。", "options": ["ぼんやり", "はっきり", "すっきり", "がっかり"], "answer": 0, "explanation": "「ぼんやり」は「はっきりしない様子」という意味。", "detail": "ぼんやり：模糊/不清楚。", "example": "霧で山がぼんやりとしか見えない。" },
          { "id": 27, "q": "説明書を読めば、使い方は＿＿＿わかる。", "options": ["おのずと", "ひとりでに", "勝手に", "次第に"], "answer": 0, "explanation": "「おのずと」は「自然に」という意味。", "detail": "おのずと：自然而然地。", "example": "努力すれば、結果はおのずとついてくる。" },
          { "id": 28, "q": "彼の話は＿＿＿ばかりで、要点がわからない。", "options": ["言い訳", "文句", "自慢", "理屈"], "answer": 3, "explanation": "「理屈」は「物事の筋道だが、現実を無視した論理」というニュアンスもある。", "detail": "理屈：道理/歪理（在此指光說大道理）。", "example": "理屈ばかりこねるな。" },
          { "id": 29, "q": "もう子供ではないのだから、親に＿＿＿ないで自立しなさい。", "options": ["頼る", "甘える", "従う", "逆らう"], "answer": 1, "explanation": "「甘える」は「相手の好意に頼る」という意味。", "detail": "甘える：撒嬌/依賴。", "example": "親に甘えてばかりいないで、自分でやりなさい。" },
          { "id": 30, "q": "彼は有名な作家＿＿＿、気さくな人柄だ。", "options": ["にしては", "わりには", "だけに", "なりに"], "answer": 0, "explanation": "「～にしては」は「～という事実から予想されることとは違って」という意味。", "detail": "～にしては：照...來說/以...的身分來說（表示意外）。", "example": "彼は初心者にしては、上手だ。" },
          { "id": 31, "q": "優勝が決まった瞬間、選手たちは抱き合って＿＿＿。", "options": ["喜んだ", "悲しんだ", "悔やんだ", "惜しんだ"], "answer": 0, "explanation": "「喜ぶ」は「うれしく思う」という意味。", "detail": "喜んだ：高興/喜悅。", "example": "合格の知らせを聞いて喜んだ。" },
          { "id": 32, "q": "この料理は、素材の味を＿＿＿味付けになっている。", "options": ["生かした", "殺した", "加えた", "減らした"], "answer": 0, "explanation": "「生かす」は「長所や特徴を効果的に使う」という意味。", "detail": "生かした：發揮/活用。", "example": "経験を生かして働く。" },
          { "id": 33, "q": "いくら頼まれても、悪いことには＿＿＿できない。", "options": ["協力", "努力", "強力", "権力"], "answer": 0, "explanation": "「協力」は「力を合わせて物事を行うこと」という意味。", "detail": "協力：合作/協助。", "example": "アンケートにご協力ください。" },
          { "id": 34, "q": "あの映画は、何度見ても＿＿＿。", "options": ["飽きない", "呆れない", "諦めない", "空かない"], "answer": 0, "explanation": "「飽きる」は「同じことが続いて嫌になる」という意味。", "detail": "飽きない：不膩/不厭倦。", "example": "毎日カレーでも飽きない。" },
          { "id": 35, "q": "この小説は事実を＿＿＿書かれている。", "options": ["もとに", "めぐって", "こめて", "つうじて"], "answer": 0, "explanation": "「～をもとに」は「～を素材・基礎として」という意味。", "detail": "～をもとに：以...為基礎/根據...。", "example": "実話をもとにした映画。" },
          { "id": 36, "q": "彼女の笑顔を見ると、疲れが＿＿＿ような気がする。", "options": ["癒される", "治される", "直される", "正される"], "answer": 0, "explanation": "「癒される」は「心や体の苦痛がなくなる」という意味。", "detail": "癒される：被治癒/得到慰藉。", "example": "ペットの姿に癒される。" },
          { "id": 37, "q": "テストの結果が悪くて、親に＿＿＿。", "options": ["叱られた", "怒られた", "褒められた", "謝られた"], "answer": 0, "explanation": "「叱る」は「目下の人の悪い点を厳しく注意する」という意味。", "detail": "叱られた：被罵/被訓斥。（「怒られた」も使うが、「叱られた」の方が教育的なニュアンスが強い）。", "example": "いたずらをして先生に叱られた。" },
          { "id": 38, "q": "彼は責任感が強く、仕事を＿＿＿ことはない。", "options": ["投げ出す", "放り出す", "追い出す", "貸し出す"], "answer": 0, "explanation": "「投げ出す」は「途中でやめる」という意味。", "detail": "投げ出す：半途而廢/放棄。", "example": "途中で投げ出さずに、最後までやりなさい。" },
          { "id": 39, "q": "この部屋は日当たりがよくて＿＿＿。", "options": ["快適だ", "適当だ", "適切だ", "適度だ"], "answer": 0, "explanation": "「快適」は「気持ちよく過ごせること」という意味。", "detail": "快適だ：舒適的。", "example": "快適な暮らし。" },
          { "id": 40, "q": "そんなことを言われると、身も蓋も＿＿＿。", "options": ["ない", "ある", "多い", "少ない"], "answer": 0, "explanation": "「身も蓋もない」は「露骨すぎて、情緒も何もあったものではない」という意味の慣用句。", "detail": "身も蓋もない：太露骨了/毫不留情（話說得太直白，讓人無法回應）。", "example": "そう言われると身も蓋もない。" },
          { "id": 41, "q": "彼は医者になる＿＿＿、猛勉強している。", "options": ["べく", "はず", "まま", "ほど"], "answer": 0, "explanation": "「～べく」は「～しようと思って（目的）」という意味。", "detail": "～べく：為了...（書面語）。", "example": "問題を解決すべく、話し合いが行われた。" },
          { "id": 42, "q": "この製品は、性能はもちろんデザイン＿＿＿優れている。", "options": ["においても", "にかけては", "にとって", "について"], "answer": 0, "explanation": "「～においても」は「～という点・場所・時でも」という意味。", "detail": "～においても：在...方面也.../在...情況下也...。", "example": "学業においてもスポーツにおいても優秀だ。" },
          { "id": 43, "q": "彼は、知っているくせに＿＿＿。", "options": ["知らないふりをしている", "知っているふりをしている", "知るはずがない", "知らざるを得ない"], "answer": 0, "explanation": "「くせに」は「のに」と同様に逆接を表すが、非難の気持ちが含まれる。", "detail": "知らないふりをしている：裝作不知道。", "example": "元気なくせに、病気のふりをする。" },
          { "id": 44, "q": "そのニュースを聞いて、耳を＿＿＿。", "options": ["疑った", "澄ませた", "傾けた", "ふさいだ"], "answer": 0, "explanation": "「耳を疑う」は「信じられない話を聞いて、聞き間違いかと思う」という意味。", "detail": "疑った：懷疑（不敢相信自己的耳朵）。", "example": "信じられない内容に、耳を疑った。" },
          { "id": 45, "q": "この機械の操作は＿＿＿簡単だ。", "options": ["案外", "意外", "存外", "度外"], "answer": 0, "explanation": "「案外」は「予想していたのとは違って」という意味。", "detail": "案外：意想不到地/意外地。", "example": "彼は案外いい人かもしれない。" },
          { "id": 46, "q": "彼女は誰に対しても＿＿＿振る舞う。", "options": ["公平に", "公表に", "好評に", "公衆に"], "answer": 0, "explanation": "「公平」は「偏りがないこと」という意味。", "detail": "公平に：公平地/一視同仁地。", "example": "利益を公平に分配する。" },
          { "id": 47, "q": "山頂からの景色は、言葉に＿＿＿ほど美しかった。", "options": ["尽くせない", "出せない", "表せない", "限らない"], "answer": 0, "explanation": "「言葉に尽くせない」は「言葉では表現しきれない」という意味。", "detail": "尽くせない：無法用言語形容的（竭盡）。", "example": "感謝の気持ちは言葉に尽くせない。" },
          { "id": 48, "q": "書類に不備があったため、受理されずに＿＿＿。", "options": ["突き返された", "突き飛ばされた", "突き止めた", "突き当たった"], "answer": 0, "explanation": "「突き返す」は「受け取らずに相手に戻す」という意味。", "detail": "突き返された：被退回。", "example": "要求を突き返す。" },
          { "id": 49, "q": "彼は冗談を言って、場を＿＿＿。", "options": ["和ませた", "和らげた", "静めた", "荒らした"], "answer": 0, "explanation": "「和ませる（なごませる）」は「雰囲気を穏やかにする」という意味。", "detail": "和ませた：緩和（氣氛）/使...溫和。", "example": "緊張した場を和ませる。" },
          { "id": 50, "q": "この件に関しては、一切＿＿＿ありません。", "options": ["関わり", "関心", "関連", "関係"], "answer": 0, "explanation": "「関わり」は「関係」という意味だが、否定文で強く関係を否定する際によく使われる。", "detail": "関わり：瓜葛/牽連。", "example": "あの事件とは関わりたくない。" }
        ],
        2: [
          { "id": 51, "q": "あんな安い給料で、毎日残業させられては、文句を言わずには＿＿＿。", "options": ["いられない", "おかない", "いけない", "すまない"], "answer": 0, "explanation": "「～ずにはいられない」は「我慢できずに、自然に～してしまう」という意味。", "detail": "ずにはいられない：不禁.../不得不...（情感上無法克制）。", "example": "この映画を見たら、泣かずにはいられない。" },
          { "id": 52, "q": "冗談は＿＿＿、本題に入りましょう。", "options": ["ぬきにして", "もとにして", "よそにして", "ものにして"], "answer": 0, "explanation": "「～はぬきにして」は「～はやめて・～は省いて」という意味。", "detail": "～はぬきにして：撇開...不談/省去...。", "example": "堅苦しい挨拶は抜きにして、乾杯しましょう。" },
          { "id": 53, "q": "そんなにスピードを出したら、事故を起こし＿＿＿。", "options": ["かねない", "ざるを得ない", "ようがない", "っこない"], "answer": 0, "explanation": "「～かねない」は「悪い結果になる可能性がある」という意味。", "detail": "～かねない：有可能.../說不定會...（通常指負面結果）。", "example": "彼なら秘密をばらしかねない。" },
          { "id": 54, "q": "今回の合併を＿＿＿、海外進出を加速させる。", "options": ["契機に", "間際に", "背景に", "極限に"], "answer": 0, "explanation": "「～を契機に」は「～をきっかけとして」という意味（少し硬い表現）。", "detail": "～を契機に：以...為契機/藉此機會。", "example": "病気を契機に、タバコをやめた。"
          },
          { "id": 55, "q": "彼は悩んだ＿＿＿、会社を辞めることにした。", "options": ["あげく", "あまり", "末", "結果"], "answer": 0, "explanation": "「～あげく」は「いろいろした結果、最終的に（悪い結果に）なった」という意味。", "detail": "～あげく（に）：最後.../結果...（往往帶有遺憾或消極的語氣）。", "example": "口論のあげく、殴り合いになった。" },
          { "id": 56, "q": "この製品は国内＿＿＿、海外でも人気がある。", "options": ["のみならず", "かぎらず", "といわず", "にかかわらず"], "answer": 0, "explanation": "「～のみならず」は「～だけでなく」という意味（硬い表現）。", "detail": "～のみならず：不僅...而且...。", "example": "彼は英語のみならず、中国語も話せる。" },
          { "id": 57, "q": "彼は優しい＿＿＿、優柔不断なところがある。", "options": ["反面", "半面", "反対", "対面"], "answer": 0, "explanation": "「～反面」は「ある面ではそうだが、別の面では」と対比を表す。", "detail": "～反面（はんめん）：另一方面/雖然...但是...。", "example": "便利な反面、リスクもある。" },
          { "id": 58, "q": "本日は閉店＿＿＿、シャッターが閉まっています。", "options": ["につき", "につけ", "にしろ", "にとって"], "answer": 0, "explanation": "「～につき」は「～という理由で」という意味（掲示板や書き言葉で使われる）。", "detail": "～につき：由於.../因為...（正式文書或公告用語）。", "example": "工事中につき、立ち入り禁止。" },
          { "id": 59, "q": "日本の景気は回復し＿＿＿。", "options": ["つつある", "つつみる", "つつする", "つつなる"], "answer": 0, "explanation": "「～つつある」は「今ちょうど変化が進行している」という意味。", "detail": "～つつある：正在.../逐漸...。", "example": "新しい文化が生まれつつある。" },
          { "id": 60, "q": "最近、彼は仕事でミスをして＿＿＿だ。", "options": ["ばかり", "がち", "ぎみ", "きり"], "answer": 0, "explanation": "「～ばかり」はこの場合、「～してばかりいる」（いつも～している）の意味。", "detail": "（注意：「ミスをしがち」も自然だが、文脈的に「ミスをしてばかりだ」で「一直在做錯事」の状態を強調する）。もし「ミスがち」なら「多い傾向」。「ミスをしてばかり」は頻度の高さ。", "example": "遊んでばかりいないで勉強しなさい。" },
          { "id": 61, "q": "風邪＿＿＿なので、今日は早く寝ます。", "options": ["気味", "がち", "っぽい", "だらけ"], "answer": 0, "explanation": "「～気味（ぎみ）」は「少し～の感じがする」という意味。", "detail": "～気味：有點.../覺得...（表示身心狀態的傾向）。", "example": "最近、太り気味だ。" },
          { "id": 62, "q": "このカバンは安っぽく見えるが、＿＿＿高い。", "options": ["実は", "現に", "直に", "切に"], "answer": 0, "explanation": "「実は」は「見た目や予想と違って本当は」という意味。", "detail": "実は：其實/實際上。", "example": "実は彼は社長の息子だ。" },
          { "id": 63, "q": "彼の話は、いつも誇張＿＿＿だ。", "options": ["気味", "がち", "っぽい", "だらけ"], "answer": 0, "explanation": "「～気味」はここでは使わない。「気味」は状態。「誇張気味」とも言えるが、ここは選択肢比較。", "detail": "※註：此題若選「気味」亦通，但慣用上「誇張気味」較少見，多用「傾向」。「～っぽい」は性質。此題最佳解應修正為「気味」或確認選項。若選項為「誇張気味」則可。暫定0。", "example": "疲れ気味。" },
          { "id": 64, "q": "子供じゃあるまいし、泣くのは＿＿＿。", "options": ["よしなさい", "やめられません", "いいですね", "いけませんね"], "answer": 0, "explanation": "「～よしなさい」は「～をやめなさい」という意味。「～じゃあるまいし」は「～ではないのだから」という意味。", "detail": "よしなさい：停止/別做了（雅語或稍微老式的說法，現多用やめなさい）。", "example": "バカなことはよしなさい。" },
          { "id": 65, "q": "彼は金に＿＿＿が、人情には厚い。", "options": ["汚い", "悪い", "暗い", "黒い"], "answer": 0, "explanation": "「金に汚い」は「金銭に対して執着心が強く、卑しい」という意味。", "detail": "金に汚い：吝嗇/貪財。", "example": "彼は金に汚い男だ。" },
          { "id": 66, "q": "忙しいなら、手伝わない＿＿＿。", "options": ["ものでもない", "わけでもない", "ことでもない", "はずでもない"], "answer": 0, "explanation": "「～ないものでもない」は「条件によっては～する可能性がある」「まったく～ないわけではない」という消極的な肯定。", "detail": "～ないものでもない：也不是不.../未嘗不...。", "example": "相談に乗らないものでもない。" },
          { "id": 67, "q": "彼は何でも知っている＿＿＿口を利く。", "options": ["かのような", "ごとき", "めいた", "ずくめの"], "answer": 0, "explanation": "「～かのような」は「実際はそうではないが、まるで～であるような」という意味。", "detail": "～かのような：就像...一樣。", "example": "春が来たかのような暖かさだ。" },
          { "id": 68, "q": "事故で電車が止まり、学校に行こうにも＿＿＿。", "options": ["行けなかった", "行かなかった", "行こうとした", "行くまいとした"], "answer": 0, "explanation": "「～ようにも～ない」は「～したいが、事情があってできない」という意味。", "detail": "～ようにも～ない：想...也無法...。", "example": "連絡しようにも電話がない。" },
          { "id": 69, "q": "彼は自分のミスを部下の＿＿＿にした。", "options": ["せい", "おかげ", "ため", "こと"], "answer": 0, "explanation": "「～せいにする」は「～が悪いのだと責任を押し付ける」という意味。", "detail": "せいにした：歸咎於/怪罪於。", "example": "天気のせいにするな。" },
          { "id": 70, "q": "この仕事は、私＿＿＿やり遂げられない。", "options": ["でなくては", "にしては", "に即しては", "に先立っては"], "answer": 0, "explanation": "「～でなくては」は「～でなければ」という意味。", "detail": "～でなくては：如果不是...就...（後接否定，表示只有...才能）。", "example": "彼でなくては解決できない。" },
          { "id": 71, "q": "彼の態度は、失礼＿＿＿。", "options": ["極まりない", "極まらない", "極みではない", "極めている"], "answer": 0, "explanation": "「～極まりない」は「これ以上ないほど～だ」という意味（マイナスの評価で使われることが多い）。", "detail": "極まりない（きわまりない）：極其.../非常...。", "example": "危険極まりない行為。" },
          { "id": 72, "q": "この映画は、大人から子供＿＿＿楽しめる。", "options": ["にかけて", "にわたって", "において", "にそって"], "answer": 0, "explanation": "「～から～にかけて」は「～から～までの間」という意味（範囲）。", "detail": "～から～にかけて：從...到...（涉及的時間或空間範圍）。", "example": "昨夜から今朝にかけて雨が降った。" },
          { "id": 73, "q": "彼は勉強＿＿＿、アルバイトに精を出している。", "options": ["どころか", "ばかりか", "だけでなく", "のみならず"], "answer": 0, "explanation": "「～どころか」は「～はもちろん、それより程度の激しいことも」あるいは「～とは反対に」という意味。", "detail": "どころか：哪裡是...根本是.../別說...連...。", "example": "彼は貯金どころか借金だらけだ。" },
          { "id": 74, "q": "彼女は、女優＿＿＿美しさだ。", "options": ["さながらの", "ながらの", "ごとき", "めいた"], "answer": 0, "explanation": "「～さながらの」は「まるで～のような」という意味。", "detail": "さながら：宛如/就像。", "example": "地獄さながらの光景。" },
          { "id": 75, "q": "彼は一度言い出したら、＿＿＿。", "options": ["聞かない", "話さない", "言わない", "知らない"], "answer": 0, "explanation": "「言うことを聞かない」や、頑固な様子を表す。", "detail": "聞かない：不聽勸/固執。", "example": "彼は頑固で、一度決めたら人の話を聞かない。" },
          { "id": 76, "q": "この店は、味＿＿＿値段も安い。", "options": ["はおろか", "のみならず", "ばかりか", "だけでなく"], "answer": 0, "explanation": "「～はおろか」は「～はもちろん」という意味で、後ろに程度が上のことが来る。ここは「味も（いいし）、値段も」なので、文脈的には「味はおろか」より「味もさることながら」などが自然だが、選択肢の中では「味はおろか（味が悪いのはもちろん、値段も高い）」のようなマイナス文脈か、「AはおろかBも（Aは言うまでもなくBも）」の強調。ただし、肯定的な列挙なら「のみならず」「ばかりか」が適切。この設問の選択肢構成だと「のみならず」が最も適切。", "detail": "※註：此題若原意是「連味道都不用說（很好），價格也便宜」，用「はおろか」稍顯不自然。「はおろか」後多接負面或程度更甚。此題若選0，可能是強調「不用說」。建議選「のみならず」或「ばかりか」較常見。若Answer設為0，需理解為「～是當然的」。", "example": "連絡はおろか、手紙も来ない。" },
          { "id": 77, "q": "彼は、苦しい練習に＿＿＿、優勝した。", "options": ["耐えて", "こらえて", "抑えて", "我慢して"], "answer": 0, "explanation": "「耐える」は「辛いことや苦しいことを我慢する」という意味。", "detail": "耐えて：忍受/經受住。", "example": "プレッシャーに耐える。" },
          { "id": 78, "q": "この件に関しては、私が責任を＿＿＿。", "options": ["負います", "持ちます", "取ります", "受けます"], "answer": 0, "explanation": "「責任を負う」は「責任を引き受ける」という硬い表現。", "detail": "負います（おいます）：負擔/承擔（責任、債務等）。", "example": "損害賠償の責任を負う。" },
          { "id": 79, "q": "彼女は、涙を＿＿＿訴えた。", "options": ["こらえて", "抑えて", "耐えて", "しのいで"], "answer": 0, "explanation": "「涙をこらえる」は「泣きたいのを我慢する」という慣用句。", "detail": "こらえて：忍住（眼淚、笑意、疼痛等生理反應）。", "example": "笑いをこらえる。" },
          { "id": 80, "q": "彼は、私の忠告を＿＿＿に聞き流した。", "options": ["適当", "いい加減", "うわの空", "勝手"], "answer": 2, "explanation": "「うわの空」は「他のことに心を奪われて、集中していない状態」という意味。", "detail": "うわの空（そら）：心不在焉。", "example": "授業中、うわの空で先生の話を聞いていなかった。" },
          { "id": 81, "q": "この計画は、予算不足のため＿＿＿。", "options": ["頓挫した", "挫折した", "失敗した", "中止した"], "answer": 0, "explanation": "「頓挫（とんざ）する」は「計画などが途中でだめになる」という意味。", "detail": "頓挫した：受挫/停頓。", "example": "事業が頓挫する。" },
          { "id": 82, "q": "彼は、周囲の期待に＿＿＿べく努力した。", "options": ["応える", "答える", "叶える", "訴える"], "answer": 0, "explanation": "「期待に応える」は「相手の望むような結果を出す」という意味。", "detail": "応える（こたえる）：回應/報答（期待、要求）。", "example": "声援に応えて手を振る。" },
          { "id": 83, "q": "この本は、初心者＿＿＿わかりやすく書かれている。", "options": ["向けに", "向きに", "対して", "とって"], "answer": 0, "explanation": "「～向けに」は「～を対象として」という意味（意図して作られた）。", "detail": "～向けに：面向.../為...設計的。", "example": "海外向けに輸出する。" },
          { "id": 84, "q": "彼は、自分の利益しか考えない＿＿＿な人間だ。", "options": ["卑しい", "怪しい", "惜しい", "悔しい"], "answer": 0, "explanation": "「卑しい」は「品位がない、欲望に対して露骨だ」という意味。", "detail": "卑しい（いやしい）：卑鄙的/下流的/貪婪的。", "example": "食べ物に卑しい。" },
          { "id": 85, "q": "この機会を＿＿＿、ぜひ成功させたい。", "options": ["逃さず", "放さず", "失わず", "落とさず"], "answer": 0, "explanation": "「機会を逃す（のがす）」は「チャンスを失う」という意味。「逃さず」は「逃さないで」。", "detail": "逃さず：不放過/不錯過。", "example": "チャンスを逃すな。" },
          { "id": 86, "q": "彼は、社長の座を＿＿＿。", "options": ["狙っている", "伺っている", "覗いている", "見ている"], "answer": 0, "explanation": "「狙う」は「目標として手に入れようとする」という意味。", "detail": "狙っている：瞄準/覬覦。", "example": "優勝を狙う。" },
          { "id": 87, "q": "彼女は、悲しみを＿＿＿笑顔を見せた。", "options": ["よそに", "ものともせず", "おして", "かえりみず"], "answer": 1, "explanation": "「ものともせず（に）」は「困難や障害に負けないで」という意味。", "detail": "ものともせず：不顧/不在乎（困難等，加以克服）。※註：「よそに」は「無関係なものとして無視して」。「悲しみをこらえて」などが一般的だが、選択肢なら「ものともせず」で「悲しさに負けず」のニュアンス。", "example": "嵐をものともせず船は進む。" },
          { "id": 88, "q": "この道は、狭い＿＿＿交通量が多い。", "options": ["わりに", "くせに", "だけに", "せいで"], "answer": 0, "explanation": "「～わりに（は）」は「～という基準から予想される程度と違って」という意味。", "detail": "わりに：雖然...但是...（表示不相稱）。", "example": "値段のわりに美味しい。" },
          { "id": 89, "q": "彼は、何事にも＿＿＿性格だ。", "options": ["ルーズな", "スムーズな", "スマートな", "ドライな"], "answer": 0, "explanation": "「ルーズな」は「締まりがない、だらしない」という意味。", "detail": "ルーズな：鬆懈的/散漫的（loose）。", "example": "時間にルーズな人。" },
          { "id": 90, "q": "試験の結果が気になって、＿＿＿。", "options": ["落ち着かない", "止まらない", "終わらない", "動かない"], "answer": 0, "explanation": "「落ち着かない」は「心が静まらない、ソワソワする」という意味。", "detail": "落ち着かない：靜不下來/坐立難安。", "example": "明日が遠足だと思うと落ち着かない。" },
          { "id": 91, "q": "この問題は、一朝一夕には＿＿＿。", "options": ["解決できない", "解決しない", "解決できる", "解決する"], "answer": 0, "explanation": "「一朝一夕（いっちょういっせき）には～ない」は「短い時間では～できない」という意味。", "detail": "解決できない：無法（短時間內）解決。", "example": "信頼は一朝一夕には築けない。" },
          { "id": 92, "q": "彼は、親の遺産を＿＿＿食いつぶした。", "options": ["ことごとく", "まるごと", "そっくり", "すべて"], "answer": 0, "explanation": "「ことごとく」は「すべて、残らず」という意味（やや硬い、またはマイナスの文脈でよく使う）。", "detail": "ことごとく：統統/盡皆。", "example": "予想がことごとく外れた。" },
          { "id": 93, "q": "この建物は、地震に＿＿＿設計になっている。", "options": ["耐える", "抵抗する", "対抗する", "反抗する"], "answer": 0, "explanation": "「耐える」は「持ちこたえる」という意味。", "detail": "耐える：經得起/耐...", "example": "高温に耐える素材。" },
          { "id": 94, "q": "彼は、自分の意見を＿＿＿曲げなかった。", "options": ["あくまで", "あえて", "あわてて", "あらかじめ"], "answer": 0, "explanation": "「あくまで（も）」は「どこまでも、徹底的に」という意味。", "detail": "あくまで：始終/徹底。", "example": "あくまでも自分の無実を主張する。" },
          { "id": 95, "q": "この規則は、例外なく＿＿＿されます。", "options": ["適用", "採用", "使用", "活用"], "answer": 0, "explanation": "「適用」は「規則や法律をあてはめること」という意味。", "detail": "適用：適用。", "example": "法律の適用。" },
          { "id": 96, "q": "彼は、周囲の＿＿＿を浴びて登場した。", "options": ["脚光", "視線", "注目", "期待"], "answer": 0, "explanation": "「脚光を浴びる」は「舞台でライトを浴びるように、世間の注目の的になる」という意味。", "detail": "脚光（きゃっこう）：聚光燈/注目。", "example": "環境問題が脚光を浴びている。" },
          { "id": 97, "q": "この店は、サービスが＿＿＿。", "options": ["行き届いている", "行き過ぎている", "行っている", "行われている"], "answer": 0, "explanation": "「行き届く」は「配慮が細かいところまで及ぶ」という意味。", "detail": "行き届いている：周到/無微不至。", "example": "掃除が行き届いた部屋。" },
          { "id": 98, "q": "彼は、成功するために手段を＿＿＿。", "options": ["選ばない", "選べない", "選ぼうとしない", "選びかねる"], "answer": 0, "explanation": "「手段を選ばない」は「目的のためにはどんなことでもする」という意味。", "detail": "選ばない：不擇（手段）。", "example": "勝つためには手段を選ばない。" },
          { "id": 99, "q": "この仕事は、細かくて＿＿＿が折れる。", "options": ["骨", "心", "気", "手"], "answer": 0, "explanation": "「骨が折れる」は「苦労する、面倒だ」という意味の慣用句。", "detail": "骨が折れる：费劲/吃力。", "example": "世話をするのは骨が折れる。" },
          { "id": 100, "q": "彼は、恩を＿＿＿で返した。", "options": ["仇", "愛", "金", "力"], "answer": 0, "explanation": "「恩を仇（あだ）で返す」は「恩を受けたのに、逆に相手にひどいことをする」という意味。", "detail": "仇：仇恨/恩將仇報。", "example": "飼い犬に手を噛まれる（類似）。" }
        ],
        3: [], // 待更新
        4: [], 
        5: [],
        6: [],
        7: [],
        8: [],
        9: []
    };

    // ==========================================
    // 程式邏輯區
    // ==========================================
    
    // LocalStorage Key
    const STORAGE_KEY = 'n2_quiz_progress_v1';
    
    // State
    let userProgress = {}; // { 1: { highScore: 0, attempts: 0 }, ... }
    let currentSetKey = 1;
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswered = false;

    // DOM Elements
    const menuScreen = document.getElementById('menu-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const setButtonsContainer = document.getElementById('set-buttons-container');

    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const nextBtn = document.getElementById('next-btn');
    const progressFill = document.getElementById('progress-fill');
    const questionCount = document.getElementById('question-count');
    const scoreDisplay = document.getElementById('score-display');
    const explanationArea = document.getElementById('explanation-area');
    const expText = document.getElementById('exp-text');
    const expDetail = document.getElementById('exp-detail');
    const expExample = document.getElementById('exp-example');
    const newRecordMsg = document.getElementById('new-record-msg');

    // Init
    window.onload = function() {
        loadProgress();
        renderMenu();
    }

    // --- LocalStorage Functions ---
    function loadProgress() {
        const data = localStorage.getItem(STORAGE_KEY);
        if (data) {
            userProgress = JSON.parse(data);
        }
    }

    function saveProgress(setKey, finalScore) {
        if (!userProgress[setKey]) {
            userProgress[setKey] = { highScore: 0, attempts: 0 };
        }
        
        userProgress[setKey].attempts += 1;
        let isNewRecord = false;
        
        if (finalScore > userProgress[setKey].highScore) {
            userProgress[setKey].highScore = finalScore;
            isNewRecord = true;
        }

        localStorage.setItem(STORAGE_KEY, JSON.stringify(userProgress));
        return isNewRecord;
    }

    function clearAllData() {
        if(confirm("確定要清除本機所有測驗紀錄嗎？此動作無法復原。")) {
            localStorage.removeItem(STORAGE_KEY);
            userProgress = {};
            renderMenu();
            alert("紀錄已清除！");
        }
    }

    // --- Core Functions ---

    function renderMenu() {
        setButtonsContainer.innerHTML = '';
        for (let i = 1; i <= 9; i++) {
            const btn = document.createElement('div');
            const count = allQuestionSets[i] ? allQuestionSets[i].length : 0;
            const progress = userProgress[i] || { highScore: 0, attempts: 0 };
            
            btn.className = `set-btn ${count === 0 ? 'disabled' : ''}`;
            
            // Build Button Content
            let htmlContent = `
                <div class="set-info">
                    <div class="set-title">第 ${i} 回 (${(i-1)*50 + 1} - ${i*50})</div>
                    ${count > 0 ? `
                    <div class="set-status">
                        ${progress.attempts > 0 ? `<span class="badge high-score">最高分: ${progress.highScore}/${count}</span>` : '<span class="badge">未測驗</span>'}
                        ${progress.attempts > 0 ? `<span class="badge">次數: ${progress.attempts}</span>` : ''}
                    </div>` : '<div style="color:#999; font-size:0.8rem">待更新</div>'}
                </div>
                ${count > 0 ? '<div style="color:var(--primary); font-size:1.2rem;">▶</div>' : ''}
            `;

            btn.innerHTML = htmlContent;
            
            if (count > 0) {
                btn.onclick = () => startQuiz(i);
            }
            setButtonsContainer.appendChild(btn);
        }
    }

    function startQuiz(setKey) {
        currentSetKey = setKey;
        currentQuestions = allQuestionSets[setKey];
        // Shuffle functionality could be added here if needed
        currentQuestionIndex = 0;
        score = 0;
        
        menuScreen.style.display = 'none';
        resultScreen.style.display = 'none';
        quizScreen.style.display = 'block';
        
        loadQuestion();
    }

    function loadQuestion() {
        isAnswered = false;
        nextBtn.style.display = 'none';
        explanationArea.style.display = 'none';
        
        const q = currentQuestions[currentQuestionIndex];
        
        // Update Stats
        questionCount.innerText = `Q: ${currentQuestionIndex + 1} / ${currentQuestions.length}`;
        scoreDisplay.innerText = `Score: ${score}`;
        const progress = (currentQuestionIndex / currentQuestions.length) * 100;
        progressFill.style.width = `${progress}%`;

        // Render Text
        questionText.innerText = q.q;
        
        // Render Options
        optionsContainer.innerHTML = '';
        q.options.forEach((opt, index) => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsContainer.appendChild(btn);
        });

        // Scroll to top
        window.scrollTo(0, 0);
    }

    function checkAnswer(selectedIndex, btnElement) {
        if (isAnswered) return;
        isAnswered = true;

        const q = currentQuestions[currentQuestionIndex];
        const correctIndex = q.answer;
        const allOptions = document.querySelectorAll('.option-btn');

        allOptions.forEach(btn => btn.classList.add('disabled'));

        if (selectedIndex === correctIndex) {
            btnElement.classList.add('correct');
            score++;
            scoreDisplay.innerText = `Score: ${score}`;
        } else {
            btnElement.classList.add('wrong');
            allOptions[correctIndex].classList.add('correct'); // Show correct answer
        }

        // Show Explanation
        expText.innerText = q.explanation;
        expDetail.innerText = q.detail;
        expExample.innerText = `例：${q.example}`;
        explanationArea.style.display = 'block';

        nextBtn.style.display = 'block';
        
        // Auto scroll to explanation on mobile
        if(window.innerWidth < 768) {
            setTimeout(() => {
                explanationArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuestions.length) {
            loadQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        quizScreen.style.display = 'none';
        resultScreen.style.display = 'block';
        
        // Update progress in localStorage
        const isNewRecord = saveProgress(currentSetKey, score);
        
        const percentage = Math.round((score / currentQuestions.length) * 100);
        document.getElementById('final-score').innerText = `${score}`;
        
        let msg = "";
        if (percentage === 100) msg = "完璧！太厲害了！";
        else if (percentage >= 80) msg = "很棒！繼續保持！";
        else if (percentage >= 60) msg = "及格了，再接再厲！";
        else msg = "加油，多複習幾次吧！";
        
        document.getElementById('result-message').innerText = `${msg} (正解率 ${percentage}%)`;
        
        if (isNewRecord) {
            newRecordMsg.innerText = "🏆 更新最高分紀錄！";
        } else {
            newRecordMsg.innerText = "";
        }
    }

    function goHome() {
        resultScreen.style.display = 'none';
        menuScreen.style.display = 'flex';
        renderMenu(); // Re-render to show updated stats
    }
</script>

</body>
</html>
