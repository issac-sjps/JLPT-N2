<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JLPT N2 Quiz System</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans JP', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            height: 100%;
        }
        
        html {
            height: 100%;
        }
        
        .app-wrapper {
            width: 100%;
            min-height: 100%;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
        }
        
        .page-header h1 {
            color: #2d3748;
            margin: 0 0 10px 0;
            font-size: 36px;
        }
        
        .page-header p {
            color: #4a5568;
            margin: 0;
            font-size: 18px;
        }
        
        .quiz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .quiz-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .quiz-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }
        
        .quiz-card.attempted {
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
            border-color: #48bb78;
        }
        
        .quiz-card.attempted:hover {
            box-shadow: 0 10px 25px rgba(72, 187, 120, 0.3);
            border-color: #38a169;
        }
        
        .quiz-card.attempted .quiz-card-title {
            color: #2f855a;
        }
        
        .quiz-card-title {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .quiz-card-stats {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.8;
        }
        
        .stat-label {
            font-weight: bold;
            color: #2d3748;
        }
        
        .start-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.2s;
        }
        
        .start-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: #f56565;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.4);
        }
        
        .question-block {
            background: #f7fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }
        
        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .question-text {
            color: #2d3748;
            font-size: 18px;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-label {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-label:hover {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .option-label input[type="radio"] {
            margin-right: 12px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        
        .option-text {
            color: #2d3748;
            font-size: 16px;
        }
        
        .submit-section {
            text-align: center;
            margin-top: 40px;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 50px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .submit-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .back-btn {
            background: #4a5568;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 15px;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: #2d3748;
            transform: translateY(-2px);
        }
        
        .result-section {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-top: 30px;
        }
        
        .result-section h2 {
            margin: 0 0 15px 0;
            font-size: 28px;
        }
        
        .score-display {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .result-message {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .correct {
            background: #c6f6d5 !important;
            border-color: #48bb78 !important;
        }
        
        .incorrect {
            background: #fed7d7 !important;
            border-color: #f56565 !important;
        }
        
        .explanation {
            margin-top: 15px;
            padding: 20px;
            background: #fff5f5;
            border-left: 4px solid #f56565;
            border-radius: 8px;
            font-size: 15px;
            line-height: 1.8;
            color: #2d3748;
        }
        
        .explanation.correct-exp {
            background: #f0fff4;
            border-left-color: #48bb78;
        }
        
        .explanation-label {
            font-weight: bold;
            color: #c53030;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .explanation.correct-exp .explanation-label {
            color: #2f855a;
        }
        
        .correct-answer {
            font-weight: bold;
            color: #2f855a;
            display: block;
            margin-bottom: 10px;
        }
        
        .explanation-detail {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }
        
        .example-sentence {
            background: rgba(255,255,255,0.5);
            padding: 8px 12px;
            border-radius: 6px;
            margin-top: 8px;
            font-style: italic;
        }
        
        .hidden {
            display: none;
        }
        
        .inline-message {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .confirm-dialog {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
        }
        
        .confirm-dialog h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
        }
        
        .confirm-dialog p {
            margin: 0 0 20px 0;
            color: #4a5568;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .confirm-yes {
            background: #f56565;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .confirm-no {
            background: #e2e8f0;
            color: #2d3748;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <main class="app-wrapper">
   <div class="main-container"><!-- Home Page -->
    <div id="home-page">
     <header class="page-header">
      <h1 id="main-title">JLPT N2 ç·´ç¿’æ¸¬é©—ç³»çµ±</h1>
      <p id="subtitle">é¸æ“‡æ¸¬é©—é–‹å§‹ç·´ç¿’ï¼Œæœ¬æ©Ÿè¨˜éŒ„ä½ çš„å­¸ç¿’é€²åº¦ï¼</p>
     </header>
     <div class="quiz-grid" id="quiz-grid"></div>
     <div class="action-buttons"><button class="action-btn" id="clear-data-btn">ğŸ—‘ï¸ æ¸…ç©ºæœ¬æ©Ÿè¨˜éŒ„</button>
     </div>
    </div><!-- Quiz Page -->
    <div id="quiz-page" class="hidden">
     <header class="page-header">
      <h1 id="quiz-page-title">æ¸¬é©—ä¸€</h1>
      <p>å…±50é¡Œï¼Œè«‹ä»”ç´°ä½œç­”</p>
     </header>
     <form id="quiz-form"></form>
     <div class="submit-section"><button type="button" class="back-btn" id="back-to-home">è¿”å›é¦–é </button> <button type="button" id="submit-btn" class="submit-btn">æäº¤ç­”æ¡ˆ</button>
     </div>
     <div id="result-section" style="display: none;"></div>
    </div>
   </div>
  </main>
  <script>
        const defaultConfig = {
            main_title: "JLPT N2 ç·´ç¿’æ¸¬é©—ç³»çµ±",
            subtitle: "é¸æ“‡æ¸¬é©—é–‹å§‹ç·´ç¿’ï¼Œæœ¬æ©Ÿè¨˜éŒ„ä½ çš„å­¸ç¿’é€²åº¦ï¼",
            background_color: "#667eea",
            surface_color: "#ffffff",
            text_color: "#2d3748",
            primary_action_color: "#667eea",
            secondary_action_color: "#f56565",
            font_family: "Noto Sans JP",
            font_size: 16
        };

        let currentQuizId = null;
        let userAnswers = {};
        let submitted = false;

        // ç”Ÿæˆ50é¡Œæ¸¬é©—è³‡æ–™
        function generateQuizQuestions(quizNum) {
            const questions = [];
            const grammarPatterns = [
                { 
                    q: "å½¼ã¯ä»•äº‹ãŒå¿™ã—ã„ã«ã‚‚ï¼¿ï¼¿ï¼¿ã€æ¯æ—¥é‹å‹•ã—ã¦ã„ã‚‹ã€‚", 
                    options: ["ã‹ã‹ã‚ã‚‰ãš", "å¯¾ã—ã¦", "é–¢ã—ã¦", "ã¤ã„ã¦"], 
                    answer: 0,
                    explanation: "ã€Œã€œã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€ã¯é€†æ¥ã®è¡¨ç¾ã§ã€å‰ã®çŠ¶æ³ãŒã‚ã‚‹ã®ã«ã€ãã‚Œã¨ã¯åå¯¾ã®ã“ã¨ãŒèµ·ã“ã‚‹ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚",
                    detail: "æ„å‘³ï¼šã€œã ãŒã€ã€œã‘ã‚Œã©ã‚‚ï¼ˆé€†æ¥ï¼‰ã€‚æ›¸ãè¨€è‘‰ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹è¡¨ç¾ã§ã™ã€‚",
                    example: "ä¾‹ï¼šé›¨ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€è©¦åˆã¯äºˆå®šé€šã‚Šè¡Œã‚ã‚ŒãŸã€‚"
                },
                { 
                    q: "ä¼šè­°ã¯3æ™‚é–“ï¼¿ï¼¿ï¼¿åŠã‚“ã ã€‚", 
                    options: ["ã«", "ã‚’", "ã§", "ãŒ"], 
                    answer: 0,
                    explanation: "ã€Œã€œã«åŠã¶ã€ã¯ã€Œã€œã¾ã§é”ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã€æ™‚é–“ã‚„ç¯„å›²ã‚’è¡¨ã™ã¨ãã«ä½¿ã„ã¾ã™ã€‚",
                    detail: "ã€Œã«åŠã¶ã€ã¯æ•°é‡ã‚„ç¨‹åº¦ãŒäºˆæƒ³ä»¥ä¸Šã«å¤§ãã„ã“ã¨ã‚’è¡¨ã™è¡¨ç¾ã§ã™ã€‚",
                    example: "ä¾‹ï¼šè¢«å®³ã¯åºƒã„ç¯„å›²ã«åŠã‚“ã ã€‚"
                },
                { 
                    q: "ä»Šæ—¥ã¯é›¨ãŒé™ã‚Šï¼¿ï¼¿ï¼¿ã ã€‚", 
                    options: ["ãã†", "ã‚ˆã†", "ã‚‰ã—ã„", "ã¿ãŸã„"], 
                    answer: 0,
                    explanation: "ã€Œé™ã‚Šãã†ã ã€ã¯æ§˜æ…‹ã‚’è¡¨ã—ã€ä»Šã«ã‚‚é›¨ãŒé™ã‚Šãã†ãªçŠ¶æ³ã‚’è¡¨ã—ã¾ã™ã€‚å‹•è©ã¾ã™å½¢ï¼‹ãã†ã ã€‚",
                    detail: "ã€Œã€œãã†ã ã€ã¯è¦‹ãŸç›®ã‚„çŠ¶æ³ã‹ã‚‰åˆ¤æ–­ã—ãŸæ¨æ¸¬ã‚’è¡¨ã—ã¾ã™ã€‚",
                    example: "ä¾‹ï¼šã“ã®ã‚±ãƒ¼ã‚­ã¯ç¾å‘³ã—ãã†ã ã€‚"
                },
                { 
                    q: "å½¼å¥³ã¯å„ªã—ã„ï¼¿ï¼¿ï¼¿é ­ã‚‚ã„ã„ã€‚", 
                    options: ["ã°ã‹ã‚Šã‹", "ã†ãˆã«", "ã‚‚ã®ã®", "ã‚ã‚Šã«"], 
                    answer: 1,
                    explanation: "ã€Œã€œã†ãˆã«ã€ã¯ã€Œã€œã«åŠ ãˆã¦ã€ã¨ã„ã†æ„å‘³ã§ã€è‰¯ã„ã“ã¨ã‚’é‡ã­ã¦è¿°ã¹ã‚‹ã¨ãã«ä½¿ã„ã¾ã™ã€‚",
                    detail: "å‰ã®äº‹æŸ„ã«ã€ã•ã‚‰ã«åˆ¥ã®äº‹æŸ„ã‚’ä»˜ã‘åŠ ãˆã‚‹è¡¨ç¾ã§ã™ã€‚ãƒ—ãƒ©ã‚¹ã®å†…å®¹ã«ã‚‚ãƒã‚¤ãƒŠã‚¹ã®å†…å®¹ã«ã‚‚ä½¿ãˆã¾ã™ã€‚",
                    example: "ä¾‹ï¼šã“ã®åº—ã¯å®‰ã„ã†ãˆã«ã€ç¾å‘³ã—ã„ã€‚"
                },
                { 
                    q: "æ™‚é–“ãŒãªã„ï¼¿ï¼¿ï¼¿ã€ãŠé‡‘ã‚‚ãªã„ã€‚", 
                    options: ["ã†ãˆã«", "ã°ã‹ã‚Šã‹", "ã®ã¿ãªã‚‰ãš", "ã™ã¹ã¦æ­£è§£"], 
                    answer: 3,
                    explanation: "ã€Œã†ãˆã«ã€ã€Œã°ã‹ã‚Šã‹ã€ã€Œã®ã¿ãªã‚‰ãšã€ã¯ã™ã¹ã¦ã€Œã•ã‚‰ã«ã€œã‚‚ã€ã¨ã„ã†æ„å‘³ã§ä½¿ãˆã¾ã™ã€‚",
                    detail: "3ã¤ã¨ã‚‚è¿½åŠ ã®æƒ…å ±ã‚’è¿°ã¹ã‚‹è¡¨ç¾ã§ã™ãŒã€ã€Œã®ã¿ãªã‚‰ãšã€ã¯æ›¸ãè¨€è‘‰ã§ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚",
                    example: "ä¾‹ï¼šå½¼ã¯æ—¥æœ¬èªã®ã¿ãªã‚‰ãšã€ä¸­å›½èªã‚‚è©±ã›ã‚‹ã€‚"
                },
                { 
                    q: "ã“ã®å•é¡Œã¯ç°¡å˜ï¼¿ï¼¿ï¼¿è¦‹ãˆã¦ã€å®Ÿã¯é›£ã—ã„ã€‚", 
                    options: ["ãã†ã«", "ã‚ˆã†ã«", "ã«", "ã§"], 
                    answer: 0,
                    explanation: "ã€Œã€œãã†ã«è¦‹ãˆã¦ã€ã¯å¤–è¦‹ã‚„å°è±¡ã‚’è¡¨ã™è¡¨ç¾ã§ã™ã€‚å½¢å®¹è©èªå¹¹ï¼‹ãã†ã«è¦‹ãˆã¦ã€‚",
                    detail: "è¦‹ãŸç›®ã®å°è±¡ã¨å®Ÿéš›ãŒç•°ãªã‚‹ã“ã¨ã‚’è¿°ã¹ã‚‹è¡¨ç¾ã§ã€å¾Œã‚ã«ã¯é€†æ¥çš„ãªå†…å®¹ãŒç¶šãã¾ã™ã€‚",
                    example: "ä¾‹ï¼šå½¼ã¯çœŸé¢ç›®ãã†ã«è¦‹ãˆã¦ã€å®Ÿã¯éŠã³å¥½ãã ã€‚"
                },
                { 
                    q: "å½¼ã¯åŒ»è€…ã§ã‚ã‚‹ï¼¿ï¼¿ï¼¿ã€ä½œå®¶ã§ã‚‚ã‚ã‚‹ã€‚", 
                    options: ["ã¨ã¨ã‚‚ã«", "ã°ã‹ã‚Šã‹", "ã¨åŒæ™‚ã«", "ã™ã¹ã¦æ­£è§£"], 
                    answer: 3,
                    explanation: "ã€Œã¨ã¨ã‚‚ã«ã€ã€Œã°ã‹ã‚Šã‹ã€ã€Œã¨åŒæ™‚ã«ã€ã¯ã™ã¹ã¦è¤‡æ•°ã®å½¹å‰²ã‚’è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ã€‚",
                    detail: "è¤‡æ•°ã®ç«‹å ´ã‚„çŠ¶æ…‹ãŒåŒæ™‚ã«æˆã‚Šç«‹ã¤ã“ã¨ã‚’è¡¨ç¾ã™ã‚‹æ–‡æ³•ã§ã™ã€‚",
                    example: "ä¾‹ï¼šå½¼å¥³ã¯æ•™å¸«ã§ã‚ã‚‹ã¨ã¨ã‚‚ã«ã€æ¯è¦ªã§ã‚‚ã‚ã‚‹ã€‚"
                },
                { 
                    q: "é¢¨é‚ªã‚’å¼•ã„ãŸï¼¿ï¼¿ï¼¿ã€ä¼šç¤¾ã‚’ä¼‘ã‚“ã ã€‚", 
                    options: ["ãŸã‚", "ã®ã§", "ã‹ã‚‰", "ã™ã¹ã¦æ­£è§£"], 
                    answer: 3,
                    explanation: "ã€ŒãŸã‚ã€ã€Œã®ã§ã€ã€Œã‹ã‚‰ã€ã¯ã™ã¹ã¦ç†ç”±ã‚’è¡¨ã™æ¥ç¶šè¡¨ç¾ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚",
                    detail: "ã€ŒãŸã‚ã€ã¯æ›¸ãè¨€è‘‰ã€ã€Œã®ã§ã€ã¯ä¸å¯§ã€ã€Œã‹ã‚‰ã€ã¯å£èªçš„ãªè¡¨ç¾ã§ã™ã€‚",
                    example: "ä¾‹ï¼šé›¨ãŒé™ã£ãŸãŸã‚ã€è©¦åˆã¯ä¸­æ­¢ã«ãªã£ãŸã€‚"
                },
                { 
                    q: "è©¦é¨“ã«åˆæ ¼ã™ã‚‹ï¼¿ï¼¿ï¼¿ã€æ¯æ—¥å‹‰å¼·ã—ã¦ã„ã‚‹ã€‚", 
                    options: ["ãŸã‚ã«", "ã‚ˆã†ã«", "ã“ã¨ã«", "ã‚‚ã®"], 
                    answer: 0,
                    explanation: "ã€Œã€œãŸã‚ã«ã€ã¯ç›®çš„ã‚’è¡¨ã™è¡¨ç¾ã§ã™ã€‚æ„å¿—å‹•è©ï¼‹ãŸã‚ã«ã€‚",
                    detail: "ã€ŒãŸã‚ã«ã€ã¯ç›®çš„ã€ã€Œã‚ˆã†ã«ã€ã¯ç„¡æ„å¿—å‹•è©ã‚„å¯èƒ½å½¢ã¨ä¸€ç·’ã«ä½¿ã„ã¾ã™ã€‚",
                    example: "ä¾‹ï¼šå®¶ã‚’è²·ã†ãŸã‚ã«ã€è²¯é‡‘ã—ã¦ã„ã‚‹ã€‚"
                },
                { 
                    q: "å½¼ã¯æ—¥æœ¬äººï¼¿ï¼¿ï¼¿æ¼¢å­—ãŒèª­ã‚ãªã„ã€‚", 
                    options: ["ã®ã«", "ã‘ã‚Œã©", "ãŒ", "ã™ã¹ã¦æ­£è§£"], 
                    answer: 3,
                    explanation: "ã€Œã®ã«ã€ã€Œã‘ã‚Œã©ã€ã€ŒãŒã€ã¯ã™ã¹ã¦é€†æ¥ã‚’è¡¨ã™æ¥ç¶šè¡¨ç¾ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚",
                    detail: "ã€Œã®ã«ã€ã¯æ„å¤–ãªæ°—æŒã¡ãŒå¼·ãã€ã€Œã‘ã‚Œã©ã€ã€ŒãŒã€ã¯ä¸­ç«‹çš„ãªé€†æ¥ã§ã™ã€‚",
                    example: "ä¾‹ï¼šé«˜ã„ã®ã«ã€ã‚ã¾ã‚Šç¾å‘³ã—ããªã„ã€‚"
                }
            ];
            
            for (let i = 0; i < 50; i++) {
                const pattern = grammarPatterns[i % 10];
                questions.push({
                    q: pattern.q,
                    options: pattern.options,
                    answer: pattern.answer,
                    explanation: pattern.explanation,
                    detail: pattern.detail,
                    example: pattern.example
                });
            }
            return questions;
        }

        const quizData = {
            "quiz1": generateQuizQuestions(1),
            "quiz2": generateQuizQuestions(2),
            "quiz3": generateQuizQuestions(3),
            "quiz4": generateQuizQuestions(4),
            "quiz5": generateQuizQuestions(5),
            "quiz6": generateQuizQuestions(6),
            "quiz7": generateQuizQuestions(7),
            "quiz8": generateQuizQuestions(8),
            "quiz9": generateQuizQuestions(9)
        };

        function getLocalStats() {
            const stats = localStorage.getItem('jlpt_quiz_stats');
            return stats ? JSON.parse(stats) : {};
        }

        function saveLocalStats(stats) {
            localStorage.setItem('jlpt_quiz_stats', JSON.stringify(stats));
        }

        function initializeApp() {
            renderQuizCards();
            setupEventListeners();
        }

        function renderQuizCards() {
            const quizGrid = document.getElementById('quiz-grid');
            const quizIds = Object.keys(quizData);
            const stats = getLocalStats();
            
            quizGrid.innerHTML = '';
            
            quizIds.forEach((quizId, index) => {
                const quizStat = stats[quizId] || { attempts: 0, highestScore: 0, total: 50 };
                const hasAttempted = quizStat.attempts > 0;
                
                const card = document.createElement('div');
                card.className = hasAttempted ? 'quiz-card attempted' : 'quiz-card';
                card.innerHTML = `
                    <div class="quiz-card-title">æ¸¬é©— ${index + 1} ${hasAttempted ? 'âœ“' : ''}</div>
                    <div class="quiz-card-stats">
                        <div><span class="stat-label">å·²æ¸¬é©—ï¼š</span>${quizStat.attempts} æ¬¡</div>
                        <div><span class="stat-label">æœ€é«˜åˆ†ï¼š</span>${quizStat.highestScore} / 50</div>
                    </div>
                    <button class="start-btn" data-quiz-id="${quizId}">${hasAttempted ? 'å†æ¬¡æ¸¬é©—' : 'é–‹å§‹æ¸¬é©—'}</button>
                `;
                quizGrid.appendChild(card);
            });

            document.querySelectorAll('.start-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    startQuiz(this.dataset.quizId);
                });
            });
        }

        function setupEventListeners() {
            document.getElementById('clear-data-btn').addEventListener('click', showClearConfirmation);
            document.getElementById('back-to-home').addEventListener('click', goHome);
            document.getElementById('submit-btn').addEventListener('click', submitQuiz);
        }

        function startQuiz(quizId) {
            currentQuizId = quizId;
            userAnswers = {};
            submitted = false;
            
            const quizIndex = Object.keys(quizData).indexOf(quizId) + 1;
            document.getElementById('quiz-page-title').textContent = `æ¸¬é©— ${quizIndex}`;
            
            const form = document.getElementById('quiz-form');
            form.innerHTML = '';
            
            const questions = quizData[quizId];
            questions.forEach((q, idx) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-block';
                questionDiv.id = `question-${idx}`;
                
                const optionsHTML = q.options.map((opt, optIdx) => `
                    <label class="option-label" id="option-${idx}-${optIdx}">
                        <input type="radio" name="q${idx}" value="${optIdx}">
                        <span class="option-text">${opt}</span>
                    </label>
                `).join('');
                
                questionDiv.innerHTML = `
                    <div class="question-number">ç¬¬ ${idx + 1} é¡Œ</div>
                    <div class="question-text">${q.q}</div>
                    <div class="options">${optionsHTML}</div>
                `;
                
                form.appendChild(questionDiv);
            });
            
            form.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const questionNum = this.name.substring(1);
                    userAnswers[questionNum] = parseInt(this.value);
                });
            });
            
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('quiz-page').classList.remove('hidden');
            document.getElementById('result-section').style.display = 'none';
        }

        function submitQuiz() {
            if (submitted) return;
            
            const questions = quizData[currentQuizId];
            const totalQuestions = questions.length;
            
            if (Object.keys(userAnswers).length < totalQuestions) {
                // æ‰¾åˆ°ç¬¬ä¸€å€‹æœªä½œç­”çš„é¡Œç›®
                for (let i = 0; i < totalQuestions; i++) {
                    if (userAnswers[i] === undefined) {
                        const unansweredQuestion = document.getElementById(`question-${i}`);
                        unansweredQuestion.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        unansweredQuestion.style.boxShadow = '0 0 0 3px #f56565';
                        setTimeout(() => {
                            unansweredQuestion.style.boxShadow = '';
                        }, 2000);
                        break;
                    }
                }
                showInlineMessage('è«‹å›ç­”æ‰€æœ‰é¡Œç›®å¾Œå†æäº¤ï¼');
                return;
            }
            
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'æäº¤ä¸­...';
            
            let correctCount = 0;
            
            questions.forEach((q, idx) => {
                const questionBlock = document.getElementById(`question-${idx}`);
                const userAnswer = userAnswers[idx];
                const isCorrect = userAnswer === q.answer;
                
                if (isCorrect) correctCount++;
                
                q.options.forEach((opt, optIdx) => {
                    const optionLabel = document.getElementById(`option-${idx}-${optIdx}`);
                    if (optIdx === q.answer) {
                        optionLabel.classList.add('correct');
                    } else if (optIdx === userAnswer && !isCorrect) {
                        optionLabel.classList.add('incorrect');
                    }
                });
                
                const explanationDiv = document.createElement('div');
                explanationDiv.className = isCorrect ? 'explanation correct-exp' : 'explanation';
                explanationDiv.innerHTML = `
                    <div class="explanation-label">${isCorrect ? 'âœ“ ç­”å°äº†ï¼' : 'âœ— ç­”éŒ¯äº†'}</div>
                    ${!isCorrect ? `<span class="correct-answer">æ­£ç¢ºç­”æ¡ˆï¼š${q.options[q.answer]}</span>` : ''}
                    <div><strong>è§£èªªï¼š</strong>${q.explanation}</div>
                    <div class="explanation-detail">
                        <strong>è£œå……èªªæ˜ï¼š</strong>${q.detail}
                        <div class="example-sentence">${q.example}</div>
                    </div>
                `;
                questionBlock.appendChild(explanationDiv);
            });
            
            const percentage = Math.round((correctCount / totalQuestions) * 100);
            let message = '';
            if (percentage >= 90) message = 'å¤ªæ£’äº†ï¼ä½ çš„æ—¥èªèƒ½åŠ›éå¸¸å„ªç§€ï¼';
            else if (percentage >= 70) message = 'å¾ˆå¥½ï¼ç¹¼çºŒä¿æŒé€™å€‹æ°´æº–ï¼';
            else if (percentage >= 50) message = 'ä¸éŒ¯ï¼é‚„æœ‰é€²æ­¥çš„ç©ºé–“ï¼ŒåŠ æ²¹ï¼';
            else message = 'ç¹¼çºŒåŠªåŠ›ï¼å¤šç·´ç¿’ä¸€å®šæœƒé€²æ­¥çš„ï¼';
            
            const resultSection = document.getElementById('result-section');
            resultSection.innerHTML = `
                <h2>æ¸¬é©—å®Œæˆï¼</h2>
                <div class="score-display">${correctCount} / ${totalQuestions}</div>
                <div class="result-message">æ­£ç¢ºç‡ï¼š${percentage}%<br>${message}</div>
            `;
            resultSection.style.display = 'block';
            
            const stats = getLocalStats();
            if (!stats[currentQuizId]) {
                stats[currentQuizId] = { attempts: 0, highestScore: 0, total: totalQuestions };
            }
            stats[currentQuizId].attempts += 1;
            if (correctCount > stats[currentQuizId].highestScore) {
                stats[currentQuizId].highestScore = correctCount;
            }
            saveLocalStats(stats);
            
            submitted = true;
            submitBtn.textContent = 'å·²æäº¤';
        }

        function showInlineMessage(message) {
            const existingMsg = document.querySelector('.inline-message');
            if (existingMsg) existingMsg.remove();
            
            const msgDiv = document.createElement('div');
            msgDiv.className = 'inline-message';
            msgDiv.textContent = message;
            
            const submitSection = document.querySelector('.submit-section');
            submitSection.parentNode.insertBefore(msgDiv, submitSection);
            
            setTimeout(() => msgDiv.remove(), 3000);
        }

        function showClearConfirmation() {
            const stats = getLocalStats();
            const hasData = Object.keys(stats).length > 0;
            
            if (!hasData) {
                showInlineMessage('æ²’æœ‰è¨˜éŒ„å¯ä»¥æ¸…é™¤');
                return;
            }
            
            const overlay = document.createElement('div');
            overlay.className = 'confirm-overlay';
            
            const dialog = document.createElement('div');
            dialog.className = 'confirm-dialog';
            dialog.innerHTML = `
                <h3>ç¢ºèªæ¸…ç©ºè¨˜éŒ„</h3>
                <p>ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æœ¬æ©Ÿç­”é¡Œè¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚</p>
                <div class="confirm-buttons">
                    <button class="confirm-no">å–æ¶ˆ</button>
                    <button class="confirm-yes">ç¢ºå®šæ¸…ç©º</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            dialog.querySelector('.confirm-no').addEventListener('click', () => {
                overlay.remove();
            });
            
            dialog.querySelector('.confirm-yes').addEventListener('click', () => {
                localStorage.removeItem('jlpt_quiz_stats');
                renderQuizCards();
                overlay.remove();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            });
        }

        function goHome() {
            document.getElementById('quiz-page').classList.add('hidden');
            document.getElementById('home-page').classList.remove('hidden');
            renderQuizCards();
        }

        async function onConfigChange(config) {
            const mainTitle = document.getElementById('main-title');
            const subtitle = document.getElementById('subtitle');
            
            if (mainTitle) mainTitle.textContent = config.main_title || defaultConfig.main_title;
            if (subtitle) subtitle.textContent = config.subtitle || defaultConfig.subtitle;
            
            const bgColor = config.background_color || defaultConfig.background_color;
            const textColor = config.text_color || defaultConfig.text_color;
            const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            
            document.body.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${bgColor} 100%)`;
            document.body.style.color = textColor;
            document.body.style.fontFamily = `${customFont}, 'Microsoft JhengHei', sans-serif`;
            document.body.style.fontSize = `${baseSize}px`;
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig: defaultConfig,
                onConfigChange: onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        },
                        {
                            get: () => config.surface_color || defaultConfig.surface_color,
                            set: (value) => {
                                window.elementSdk.setConfig({ surface_color: value });
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        },
                        {
                            get: () => config.primary_action_color || defaultConfig.primary_action_color,
                            set: (value) => {
                                window.elementSdk.setConfig({ primary_action_color: value });
                            }
                        },
                        {
                            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                            set: (value) => {
                                window.elementSdk.setConfig({ secondary_action_color: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: {
                        get: () => config.font_family || defaultConfig.font_family,
                        set: (value) => {
                            window.elementSdk.setConfig({ font_family: value });
                        }
                    },
                    fontSizeable: {
                        get: () => config.font_size || defaultConfig.font_size,
                        set: (value) => {
                            window.elementSdk.setConfig({ font_size: value });
                        }
                    }
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["main_title", config.main_title || defaultConfig.main_title],
                    ["subtitle", config.subtitle || defaultConfig.subtitle]
                ])
            });
        }

        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a47471fd38d6e87',t:'MTc2NDEzODAwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
